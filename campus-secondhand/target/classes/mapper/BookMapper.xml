<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.campussecondhand.mapper.BookMapper">

    <select id="selectBookWithCategory" resultType="com.campussecondhand.pojo.dto.BookDetailDTO">
        select b.title,
        (SELECT i.imageFile FROM image i WHERE i.bookId = b.bookId LIMIT 1) AS imageFile,
        b.bookId, u.userName from
        (select * from book
            <where>
                <if test="category != null and category != ''">
                    category = #{category}
                </if>
                and status = '审核通过'
            </where>
        ) b
        left join user u on b.userId = u.userId
    </select>
    <select id="selectBookWithPriceDESC" resultType="com.campussecondhand.pojo.dto.BookSearchDetailDTO">
        select b.title,
               (SELECT i.imageFile FROM image i WHERE i.bookId = b.bookId LIMIT 1) AS imageFile,
               , b.bookId, b.price, b.description, u.userName
        from book b
        left join user u on b.userId = u.userId
        <where>
            <if test="title != null and title != ''">
                and title like concat('%', #{title}, '%')
            </if>
            <if test="priceMax != null and priceMin != null">
                and price between #{priceMin} and #{priceMax}
            </if>
            and status = '审核通过'
        </where>
        order by price desc
    </select>
    <select id="selectBookWithPriceASC" resultType="com.campussecondhand.pojo.dto.BookSearchDetailDTO">
        select b.title,
               (SELECT i.imageFile FROM image i WHERE i.bookId = b.bookId LIMIT 1) AS imageFile,
               b.bookId, b.price, b.description, u.userName
        from book b
        left join user u on b.userId = u.userId
        <where>
            <if test="title != null and title != ''">
                and title like concat('%', #{title}, '%')
            </if>
            <if test="priceMax != null and priceMin != null">
                and price between #{priceMin} and #{priceMax}
            </if>
            and status = '审核通过'
        </where>
        order by price
    </select>
    <select id="listBookByStatus" resultType="com.campussecondhand.pojo.vo.BookVO">
        select b.bookId, b.title, b.price, b.description, u.userName, u.userId from
        book b left join user u on b.userId = u.userId
        <where>
            status = #{status}
        </where>
    </select>
</mapper>
